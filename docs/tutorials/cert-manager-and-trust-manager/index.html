<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=/fonts/vendor/jost/jost-v4-latin-500.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><link rel=stylesheet href=/themify-icons/themify-icons.css><link rel=stylesheet href=/main.019d70180b3e28f1ca53875dc4405d477240c6467b69827ca1952131954983ebd84f56c334b4795efe94463a1163561d80bdd157d7535496b10ce42a7fb141fc.css integrity="sha512-AZ1wGAs+KPHKU4ddxEBdR3JAxkZ7aYJ8oZUhMZVJg+vYT1bDNLR5Xv6URjoRY1YdgL3RV9dTVJaxDOQqf7FB/A==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Setting up SSL with cert-manager and trust-manager - ArtemisCloud.io</title><meta name=description content="An example for setting up ssl connections using cert-manager and trust-manager projects"><link rel=canonical href=/docs/tutorials/cert-manager-and-trust-manager/><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="Setting up SSL with cert-manager and trust-manager"><meta property="og:description" content="An example for setting up ssl connections using cert-manager and trust-manager projects"><meta property="og:url" content="/docs/tutorials/cert-manager-and-trust-manager/"><meta property="og:site_name" content="ArtemisCloud.io"><meta property="og:image" content="/artemiscloud.png"><meta property="og:image:alt" content="ArtemisCloud.io"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@artemiscloudio"><meta name=twitter:creator content="@henkverlinde"><meta name=twitter:title content="Setting up SSL with cert-manager and trust-manager"><meta name=twitter:description content="An example for setting up ssl connections using cert-manager and trust-manager projects"><meta name=twitter:image content="/artemiscloud.png"><meta name=twitter:image:alt content="Setting up SSL with cert-manager and trust-manager"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"/#/schema/organization/1","name":"ArtemisCloud.io","url":"/","sameAs":["https://twitter.com/artemiscloudio","https://github.com/artemiscloud"],"logo":{"@type":"ImageObject","@id":"/#/schema/image/1","url":"/artemiscloud.png","width":512,"height":512,"caption":"ArtemisCloud.io"},"image":{"@id":"/#/schema/image/1"}},{"@type":"WebSite","@id":"/#/schema/website/1","url":"/","name":"ArtemisCloud.io","description":"ArtemisCloud.io is a collection of container images that provide a way to deploy the Apache ActiveMQ Artemis Broker on Kubernetes.","publisher":{"@id":"/#/schema/organization/1"}},{"@type":"WebPage","@id":"/docs/tutorials/cert-manager-and-trust-manager/","url":"/docs/tutorials/cert-manager-and-trust-manager/","name":"Setting up SSL with cert-manager and trust-manager","description":"An example for setting up ssl connections using cert-manager and trust-manager projects","isPartOf":{"@id":"/#/schema/website/1"},"about":{"@id":"/#/schema/organization/1"},"datePublished":"0001-01-01T00:00:00CET","dateModified":"0001-01-01T00:00:00CET","breadcrumb":{"@id":"/docs/tutorials/cert-manager-and-trust-manager/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"/docs/tutorials/cert-manager-and-trust-manager/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["/docs/tutorials/cert-manager-and-trust-manager/"]}]},{"@type":"BreadcrumbList","@id":"/docs/tutorials/cert-manager-and-trust-manager/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"/","url":"/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@id":"/docstutorialscert-manager-and-trust-manager/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Article","@id":"/#/schema/article/1","headline":"Setting up SSL with cert-manager and trust-manager","description":"An example for setting up ssl connections using cert-manager and trust-manager projects","isPartOf":{"@id":"/docs/tutorials/cert-manager-and-trust-manager/"},"mainEntityOfPage":{"@id":"/docs/tutorials/cert-manager-and-trust-manager/"},"datePublished":"0001-01-01T00:00:00CET","dateModified":"0001-01-01T00:00:00CET","author":{"@id":"/#/schema/person/2"},"publisher":{"@id":"/#/schema/organization/1"},"image":{"@id":"/docs/tutorials/cert-manager-and-trust-manager/#/schema/image/2"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"/#/schema/person/2","name":null,"sameAs":[]}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"/docs/tutorials/cert-manager-and-trust-manager/#/schema/image/2","url":"/artemiscloud.png","contentUrl":"/artemiscloud.png","caption":"Setting up SSL with cert-manager and trust-manager"}]}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=/site.webmanifest></head><body class="docs single"><div class=header-bar></div><header class="navbar navbar-expand-md navbar-light doks-navbar"><nav class="container-fluid flex-wrap flex-md-nowrap" aria-label="Main navigation"><a class="navbar-brand p-0 me-auto" href=/ aria-label=ArtemisCloud.io>ArtemisCloud.io</a>
<button class="btn btn-menu d-block d-md-none order-5" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasDoks aria-controls=offcanvasDoks aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class="offcanvas offcanvas-end border-0 py-md-1" tabindex=-1 id=offcanvasDoks data-bs-backdrop=true aria-labelledby=offcanvasDoksLabel><div class="header-bar d-md-none"></div><div class="offcanvas-header d-md-none"><h2 class="h5 offcanvas-title ps-2" id=offcanvasDoksLabel><a class=text-dark href=/>ArtemisCloud.io</a></h2><button type=button class="btn-close text-reset me-2" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class="offcanvas-body px-4"><h3 class="h6 text-uppercase mb-3 d-md-none">Main</h3><ul class="nav flex-column flex-md-row ms-md-n3"><li class=nav-item><a class="nav-link ps-0 py-1 active" href=/docs/getting-started/introduction/>Docs</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=/blog/>Blog</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=/community/>Community</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=/docs/getting-started/introduction/>Get Started</a></li></ul><hr class="text-black-50 my-4 d-md-none"><h3 class="h6 text-uppercase mb-3 d-md-none">Socials</h3><ul class="nav flex-column flex-md-row ms-md-auto me-md-n5 pe-md-2"><li class=nav-item><a class="nav-link ps-0 py-1" href=https://github.com/artemiscloud><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><small class="ms-2 d-md-none">GitHub</small></a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=https://twitter.com/artemiscloudio><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg><small class="ms-2 d-md-none">Twitter</small></a></li></ul></div></div><button id=mode class="btn btn-link order-md-1" type=button aria-label="Toggle user interface mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></nav></header><nav class="doks-subnavbar py-2 sticky-lg-top" aria-label="Secondary navigation"><div class="container-fluid d-flex align-items-md-center"><form class="doks-search position-relative flex-grow-1 me-auto"><input id=search class="form-control is-search" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=suggestions class="shadow bg-white rounded d-none"></div></form><button class="btn doks-sidebar-toggle d-lg-none ms-3 order-3 collapsed" type=button data-bs-toggle=collapse data-bs-target=#doks-docs-nav aria-controls=doks-docs-nav aria-expanded=false aria-label="Toggle documentation navigation"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></button></div></nav><div class=container-fluid><aside class=doks-sidebar><nav id=doks-docs-nav class="collapse d-lg-none" aria-label="Tertiary navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-cb59b87e00d11222bfd9159d0d23836f aria-expanded=false>
Getting started</button><div class=collapse id=section-cb59b87e00d11222bfd9159d0d23836f><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/docs/getting-started/introduction/>Introduction</a></li><li><a class="docs-link rounded" href=/docs/getting-started/quick-start/>Quick Start</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-6a26f548831e6a8c26bfbbd9f6ec61e0 aria-expanded=false>
Help</button><div class=collapse id=section-6a26f548831e6a8c26bfbbd9f6ec61e0><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/docs/help/building/>Building</a></li><li><a class="docs-link rounded" href=/docs/help/bundle/>Bundle</a></li><li><a class="docs-link rounded" href=/docs/help/custom-resources/>Custom Resources</a></li><li><a class="docs-link rounded" href=/docs/help/images/>Images</a></li><li><a class="docs-link rounded" href=/docs/help/operator/>Operator</a></li><li><a class="docs-link rounded" href=/docs/help/logging-guidelines/></a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-130ddfce9c28453883ccfe2da8b6d5ac aria-expanded=true>
Tutorials</button><div class="collapse show" id=section-130ddfce9c28453883ccfe2da8b6d5ac><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/docs/tutorials/deploybasicimage/>Deploying the Basic Broker Image</a></li><li><a class="docs-link rounded" href=/docs/tutorials/external_mqtt_clients/>Connecting to the broker from external mqtt clients</a></li><li><a class="docs-link rounded" href=/docs/tutorials/scaleup_and_scaledown/>Scaling Up and Down Brokers with ArtemisCloud Operator</a></li><li><a class="docs-link rounded" href=/docs/tutorials/ssl_broker_setup/>Setting up SSL connections with ArtemisCloud Operator</a></li><li><a class="docs-link rounded active" href=/docs/tutorials/cert-manager-and-trust-manager/>Setting up SSL with cert-manager and trust-manager</a></li><li><a class="docs-link rounded" href=/docs/tutorials/using_operator/>Using the ArtemisCloud Operator</a></li><li><a class="docs-link rounded" href=/docs/tutorials/initcontainer/>Using the custom init image</a></li></ul></div></li></ul></nav></aside></div><div class="wrap container-fluid" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar d-none d-lg-block"><nav class=docs-links aria-label="Main navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-cb59b87e00d11222bfd9159d0d23836f aria-expanded=false>
Getting started</button><div class=collapse id=section-cb59b87e00d11222bfd9159d0d23836f><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/docs/getting-started/introduction/>Introduction</a></li><li><a class="docs-link rounded" href=/docs/getting-started/quick-start/>Quick Start</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-6a26f548831e6a8c26bfbbd9f6ec61e0 aria-expanded=false>
Help</button><div class=collapse id=section-6a26f548831e6a8c26bfbbd9f6ec61e0><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/docs/help/building/>Building</a></li><li><a class="docs-link rounded" href=/docs/help/bundle/>Bundle</a></li><li><a class="docs-link rounded" href=/docs/help/custom-resources/>Custom Resources</a></li><li><a class="docs-link rounded" href=/docs/help/images/>Images</a></li><li><a class="docs-link rounded" href=/docs/help/operator/>Operator</a></li><li><a class="docs-link rounded" href=/docs/help/logging-guidelines/></a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-130ddfce9c28453883ccfe2da8b6d5ac aria-expanded=true>
Tutorials</button><div class="collapse show" id=section-130ddfce9c28453883ccfe2da8b6d5ac><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/docs/tutorials/deploybasicimage/>Deploying the Basic Broker Image</a></li><li><a class="docs-link rounded" href=/docs/tutorials/external_mqtt_clients/>Connecting to the broker from external mqtt clients</a></li><li><a class="docs-link rounded" href=/docs/tutorials/scaleup_and_scaledown/>Scaling Up and Down Brokers with ArtemisCloud Operator</a></li><li><a class="docs-link rounded" href=/docs/tutorials/ssl_broker_setup/>Setting up SSL connections with ArtemisCloud Operator</a></li><li><a class="docs-link rounded active" href=/docs/tutorials/cert-manager-and-trust-manager/>Setting up SSL with cert-manager and trust-manager</a></li><li><a class="docs-link rounded" href=/docs/tutorials/using_operator/>Using the ArtemisCloud Operator</a></li><li><a class="docs-link rounded" href=/docs/tutorials/initcontainer/>Using the custom init image</a></li></ul></div></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#ssl>SSL</a></li><li><a href=#prepare-keystore-and-truststore>Prepare keystore and truststore</a><ul><li><a href=#create-local-ca-certificate-authority>Create local CA (Certificate authority)</a></li><li><a href=#create-secret-for-keystore-password>Create secret for keystore password</a></li><li><a href=#create-certificate-for-activemq-artemis-brokers>Create certificate for ActiveMQ Artemis brokers</a></li><li><a href=#create-truststore-using-trust-manager>Create truststore using trust-manager</a></li><li><a href=#create-a-secret-with-the-details-of-your-ssl-setup-for-the-activemq-artemis-broker>Create a secret with the details of your ssl setup for the ActiveMQ Artemis broker</a></li></ul></li><li><a href=#deploy-artemiscloud-operator>Deploy ArtemisCloud operator</a></li><li><a href=#deploy-a-broker>Deploy a broker</a></li><li><a href=#deploy-a-queue>Deploy a queue</a></li><li><a href=#test-messaging-over-a-ssl-connection>Test messaging over a SSL connection</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl"><h1>Setting up SSL with cert-manager and trust-manager</h1><p class=lead></p><nav class=d-xl-none aria-label="Quaternary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#ssl>SSL</a></li><li><a href=#prepare-keystore-and-truststore>Prepare keystore and truststore</a><ul><li><a href=#create-local-ca-certificate-authority>Create local CA (Certificate authority)</a></li><li><a href=#create-secret-for-keystore-password>Create secret for keystore password</a></li><li><a href=#create-certificate-for-activemq-artemis-brokers>Create certificate for ActiveMQ Artemis brokers</a></li><li><a href=#create-truststore-using-trust-manager>Create truststore using trust-manager</a></li><li><a href=#create-a-secret-with-the-details-of-your-ssl-setup-for-the-activemq-artemis-broker>Create a secret with the details of your ssl setup for the ActiveMQ Artemis broker</a></li></ul></li><li><a href=#deploy-artemiscloud-operator>Deploy ArtemisCloud operator</a></li><li><a href=#deploy-a-broker>Deploy a broker</a></li><li><a href=#deploy-a-queue>Deploy a queue</a></li><li><a href=#test-messaging-over-a-ssl-connection>Test messaging over a SSL connection</a></li></ul></nav></div></nav><p>A lot of Kubernetes clusters already use cert-manager and trust-manager to handle certificates management.</p><p>The goal of this tutorial is to show how to configure ActiveMQ Artemis Operator resources to utilize both projects mentioned above for ssl communication.</p><h2 id=prerequisites>Prerequisites <a href=#prerequisites class=anchor aria-hidden=true>#</a></h2><ul><li>running Kubernetes cluster</li><li>cert-manager should be installed in the cluster in the &ldquo;cert-manager&rdquo; namespace</li><li>trust-manager should be installed in the cluster in the &ldquo;cert-manager&rdquo; namespace</li></ul><p>Installation guides for cert-manager and trust-manager you can find on the <a href=https://cert-manager.io/docs/>cert-manager project website</a>.</p><h2 id=ssl>SSL <a href=#ssl class=anchor aria-hidden=true>#</a></h2><p>There are various scenarioes how SSL can be achived for your ActiveMQ Artemis brokers, to list some:</p><ul><li>ActiveMQ Artemis brokers handling SSL termination<ul><li>you need to provide keystore with certificate and truststore</li><li>you need to configure acceptor to use ssl</li></ul></li><li>ActiveMQ Artemis brokers exposed over plain tcp (no ssl) and Istio handling SSL termination on ingress level, with mutual TLS between pods in cluster<ul><li>you need to have Istio installed in cluster</li><li>you need to configure acceptor with no ssl</li><li>you need to setup Istio resources accordingly (Istio knowledge required)</li></ul></li></ul><p>In this tutorial we will cover the first scenario &ldquo;ActiveMQ Artemis brokers handling SSL termination&rdquo; with no assumption it is the best for your cluster, please consider the best setup yourself.</p><p>Let&rsquo;s start!</p><h2 id=prepare-keystore-and-truststore>Prepare keystore and truststore <a href=#prepare-keystore-and-truststore class=anchor aria-hidden=true>#</a></h2><p>Here we are gonna use cert-manager and trust-manager to create keystore and truststore.</p><p>Our assumption is that you are gonna use local <strong>Issuer</strong> or local <strong>ClusterIssuer</strong> in cert-manager.</p><p>Another assumption is your cert-manager and trust-manager are installed in the &ldquo;cert-manager&rdquo; namespace.</p><h3 id=create-local-ca-certificate-authority>Create local CA (Certificate authority) <a href=#create-local-ca-certificate-authority class=anchor aria-hidden=true>#</a></h3><p>ℹ️ If you have already some local CA configured please go directly to the next step.</p><p>To create local CA, first we need to have base certificate for that issuer to allow it issue certificates.
This base certificate for our custom local CA should be saved into the secret in cert-manager namespace with the secret type kubernetes.io/tls.</p><p>One way of creating it is to use <strong>selfsigned-cluster-issuer</strong>:</p><p>Use kubectl apply command with file created based on the yaml below.</p><pre><code class=language-shell>kubectl apply -f &lt;file_name&gt;
</code></pre><pre><code class=language-yaml>apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: selfsigned-cluster-issuer
  namespace: cert-manager
spec:
  selfSigned: {}
---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: my-selfsigned-ca
  namespace: cert-manager
spec:
  isCA: true
  commonName: my-selfsigned-ca
  secretName: root-secret
  privateKey:
    algorithm: ECDSA
    size: 256
  issuerRef:
    name: selfsigned-cluster-issuer
    kind: ClusterIssuer
    group: cert-manager.io
---
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: my-ca-issuer
  namespace: cert-manager
spec:
  ca:
    secretName: root-secret
</code></pre><p>Now you have your own CA which can sign new certificates for you.</p><h3 id=create-secret-for-keystore-password>Create secret for keystore password <a href=#create-secret-for-keystore-password class=anchor aria-hidden=true>#</a></h3><p>Replace <strong>myproject</strong> with actual namespace your brokers are installed in.</p><p>Replace <strong>dummy_password</strong> with actual password you want to use.</p><p>You can create a secret directly using command line:</p><pre><code class=language-shell>kubectl create secret generic -n myproject jks-password-secret --from-literal=password=dummy_password
</code></pre><h3 id=create-certificate-for-activemq-artemis-brokers>Create certificate for ActiveMQ Artemis brokers <a href=#create-certificate-for-activemq-artemis-brokers class=anchor aria-hidden=true>#</a></h3><p>Create certificate resource using kubectl apply.</p><p>Replace <strong>all occuriences of myproject</strong> with actual namespace your brokers are installed in.</p><pre><code class=language-yaml>apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: amq-tls-acceptor-cert
  namespace: myproject
spec:
  secretName: amq-ssl-secret
  duration: 2160h # 90d
  renewBefore: 360h # 15d
  commonName: artemis-broker-ssl-0.myproject.svc.cluster.local
  dnsNames:
  - artemis-broker-ssl-0-svc.myproject.svc
  - artemis-broker-ssl-0-svc.myproject
  - artemis-broker-ssl-0-svc
  - artemis-broker-ss-0
  issuerRef:
    name: my-ca-issuer
    kind: ClusterIssuer
    group: cert-manager.io
  keystores:
    jks:
      create: true
      passwordSecretRef: # Password used to encrypt the keystore and truststore
        key: password
        name: jks-password-secret
</code></pre><h3 id=create-truststore-using-trust-manager>Create truststore using trust-manager <a href=#create-truststore-using-trust-manager class=anchor aria-hidden=true>#</a></h3><p>Here we will utlize trust-manager to create truststore in config map.</p><p>ℹ️ Truststore does not contain any secrets, that&rsquo;s why it is stored by trust-manager in a config map, additionally password for truststore is set by design to &ldquo;changeit&rdquo;, because of the same reason (no secrets).</p><p>It is advised to create a copy of your base CA certificate to not have an issue during CA certificate rotation event, so we will create a copy of base certificate of CA. In the phase of rotation of that certificate you would need to support old and new base CA certificate until all services use already certificates issued based on the new one. You can read more in trust-manager documentation about that topic.</p><p>Copy base ca secret:</p><pre><code class=language-shell>kubectl get secret root-secret -n=cert-manager -o yaml | sed 's/name: .+/name: local-ca-cert-copy-trust-manager/' | kubectl apply -f -
</code></pre><p>Create bundle resource which trust-manager will use to create ca budles in <strong>all</strong> namespaces of your cluster. Use <code>kubectl apply</code> with content below:</p><pre><code class=language-yaml>apiVersion: trust.cert-manager.io/v1alpha1
kind: Bundle
metadata:
  name: ca-bundle
  namespace: cert-manager
spec:
  sources:
  # all default CAs
  - useDefaultCAs: true
  # plus our custom local CA
  - secret:
      name: &quot;local-ca-cert-copy-trust-manager&quot;
      key: &quot;tls.crt&quot;
  target:
    configMap:
      key: &quot;trust-bundle.pem&quot;
    additionalFormats:
      jks:
        key: &quot;truststore.jks&quot;
</code></pre><p>This will produce configmap in all namespaces with truststore.jks and trust-bundle.pem which you can use internally for any services inside your cluster (java based or others).</p><h3 id=create-a-secret-with-the-details-of-your-ssl-setup-for-the-activemq-artemis-broker>Create a secret with the details of your ssl setup for the ActiveMQ Artemis broker <a href=#create-a-secret-with-the-details-of-your-ssl-setup-for-the-activemq-artemis-broker class=anchor aria-hidden=true>#</a></h3><p>Replace <strong>dummy_password</strong> with the password you have used in section <strong>Create secret for keystore password</strong>.</p><p><strong>Do not</strong> replace <strong>changeit</strong> password, it is like that by design, for more informations please check above in trust-manager section.</p><pre><code class=language-shell>kubectl create secret generic ssl-acceptor-ssl-secret -n myproject \
--from-literal=keyStorePath=/amq/extra/secrets/amq-ssl-secret/keystore.jks \
--from-literal=trustStorePath=/amq/extra/configmaps/ca-bundle/truststore.jks \
--from-literal=keyStorePassword=dummy_password \
--from-literal=trustStorePassword=changeit
</code></pre><h2 id=deploy-artemiscloud-operator>Deploy ArtemisCloud operator <a href=#deploy-artemiscloud-operator class=anchor aria-hidden=true>#</a></h2><p>Operator will create ActiveMQ resources based on custom resources definitions (CRD).</p><p>If you are not sure how to deploy the operator take a look at <a href=/docs/tutorials/using_operator/>here</a>.</p><p>In this tutorial we assume you deployed the operator to a namespace called <strong>activemq-artemis-operator</strong>.</p><p>Make sure the operator is in &ldquo;Runing&rdquo; status before going to the next step.
You can run this command and observe the output:</p><pre><code class=language-shell>$ kubectl get pod -n activemq-artemis-operator
NAME                                         READY   STATUS    RESTARTS   AGE
activemq-artemis-operator-58bb658f4c-zcqmw   1/1     Running   0          7m32s
</code></pre><h2 id=deploy-a-broker>Deploy a broker <a href=#deploy-a-broker class=anchor aria-hidden=true>#</a></h2><p>Example of the broker CRD is located in the local repository cloned during activities from section <strong>Deploy ArtemisCloud operator</strong>.</p><p>Replace <strong>myproject</strong> with actual namespace your brokers are installed in.</p><p>Deploy a broker with (beeing on the root folder of this repository):</p><pre><code class=language-shell>kubectl apply -f examples/artemis/artemis_ssl_acceptor_cert_and_trust_managers.yaml -n myproject
</code></pre><h2 id=deploy-a-queue>Deploy a queue <a href=#deploy-a-queue class=anchor aria-hidden=true>#</a></h2><p>Example of the queue CRD is located in the local repository cloned during activities from section <strong>Deploy ArtemisCloud operator</strong>.</p><p>Deploy a queue with (beeing on the root folder of this repository):</p><pre><code class=language-shell>kubectl apply -f examples/address/address_queue.yaml -n myproject
</code></pre><p>The CR tells the Operator to create a queue named myQueue0 on address myAddress0 on each broker that it manages.</p><p>After the CR is deployed, you can observe the queue on the broker:</p><pre><code class=language-shell>kubectl exec artemis-broker-ss-0 -n myproject -- /bin/bash /home/jboss/amq-broker/bin/artemis queue stat --user admin --password admin --url tcp://artemis-broker-ss-0:61616
OpenJDK 64-Bit Server VM warning: If the number of processors is expected to increase from one, then you should configure the number of parallel GC threads appropriately using -XX:ParallelGCThreads=N
Connection brokerURL = tcp://artemis-broker-ss-0:61616
|NAME                     |ADDRESS                  |CONSUMER_COUNT |MESSAGE_COUNT |MESSAGES_ADDED |DELIVERING_COUNT |MESSAGES_ACKED |SCHEDULED_COUNT |ROUTING_TYPE |
|DLQ                      |DLQ                      |0              |0             |0              |0                |0              |0               |ANYCAST      |
|ExpiryQueue              |ExpiryQueue              |0              |0             |0              |0                |0              |0               |ANYCAST      |
|myQueue0                 |myAddress0               |0              |0             |0              |0                |0              |0               |ANYCAST      |
</code></pre><h2 id=test-messaging-over-a-ssl-connection>Test messaging over a SSL connection <a href=#test-messaging-over-a-ssl-connection class=anchor aria-hidden=true>#</a></h2><p>Log into the broker pod first to get a shell command environment:</p><pre><code class=language-shell>kubectl exec --stdin --tty artemis-broker-ss-0 -n myproject -- /bin/bash
[jboss@artemis-broker-ss-0 ~]$
</code></pre><p>Then send 100 messages through port 61618, but before replace <strong>dummy_password</strong> with the password you have used in section <strong>Create secret for keystore password</strong>.</p><pre><code class=language-shell>cd amq-broker/bin
[jboss@artemis-broker-ss-0 bin]$ ./artemis producer --user admin --password admin --url tcp://artemis-broker-ss-0:61618?sslEnabled=true\&amp;keyStorePath=/amq/extra/secrets/amq-ssl-secret/keystore.jks\&amp;keyStorePassword=dummy_password\&amp;trustStorePath=/amq/extra/configmaps/ca-bundle/truststore.jks\&amp;trustStorePassword=changeit --message-count 100
OpenJDK 64-Bit Server VM warning: If the number of processors is expected to increase from one, then you should configure the number of parallel GC threads appropriately using -XX:ParallelGCThreads=N
Connection brokerURL = tcp://artemis-broker-ss-0:61618?sslEnabled=true\&amp;keyStorePath=/amq/extra/secrets/amq-ssl-secret/keystore.jks\&amp;keyStorePassword=dummy_password\&amp;trustStorePath=/amq/extra/configmaps/ca-bundle/truststore.jks\&amp;trustStorePassword=changeit
Producer ActiveMQQueue[TEST], thread=0 Started to calculate elapsed time ...

Producer ActiveMQQueue[TEST], thread=0 Produced: 100 messages
Producer ActiveMQQueue[TEST], thread=0 Elapsed time in second : 0 s
Producer ActiveMQQueue[TEST], thread=0 Elapsed time in milli second : 724 milli seconds
</code></pre><p>Finally you can receive those 100 messages (again replace <strong>dummy_password</strong> with the password you have used in section <strong>Create secret for keystore password</strong>):</p><pre><code class=language-shell>[jboss@artemis-broker-ss-0 bin]$ ./artemis consumer --user admin --password admin --url tcp://artemis-broker-ss-0:61618?sslEnabled=true\&amp;keyStorePath=/amq/extra/secrets/amq-ssl-secret/keystore.jks\&amp;keyStorePassword=dummy_password\&amp;trustStorePath=/amq/extra/configmaps/ca-bundle/truststore.jks\&amp;trustStorePassword=changeit --message-count 100
OpenJDK 64-Bit Server VM warning: If the number of processors is expected to increase from one, then you should configure the number of parallel GC threads appropriately using -XX:ParallelGCThreads=N
Connection brokerURL = tcp://artemis-broker-ss-0:61618?sslEnabled=true\&amp;keyStorePath=/amq/extra/secrets/amq-ssl-secret/keystore.jks\&amp;keyStorePassword=dummy_password\&amp;trustStorePath=/amq/extra/configmaps/ca-bundle/truststore.jks\&amp;trustStorePassword=changeit
Consumer:: filter = null
Consumer ActiveMQQueue[TEST], thread=0 wait until 100 messages are consumed
Consumer ActiveMQQueue[TEST], thread=0 Consumed: 100 messages
Consumer ActiveMQQueue[TEST], thread=0 Elapsed time in second : 0 s
Consumer ActiveMQQueue[TEST], thread=0 Elapsed time in milli second : 160 milli seconds
Consumer ActiveMQQueue[TEST], thread=0 Consumed: 100 messages
Consumer ActiveMQQueue[TEST], thread=0 Consumer thread finished
</code></pre><p>This confirms everything works as expected!</p><p>Have fun!</p><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"></div><div class="docs-navigation d-flex justify-content-between"><a href=/docs/tutorials/ssl_broker_setup/><div class="card my-1"><div class="card-body py-2">&larr; Setting up SSL connections with ArtemisCloud Operator</div></div></a><a class=ms-auto href=/docs/tutorials/using_operator/><div class="card my-1"><div class="card-body py-2">Using the ArtemisCloud Operator &rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class=container-fluid><div class=row><div class=col><a href=https://www.redhat.com/><img height=32px src=/images/Logo-Red_Hat-Sponsored_By-A-Standard-RGB.png alt="Red Hat"></a></div><div class=col-10><p style=font-size:12px>Apache, Apache ActiveMQ Artemis,Artemis and associated open source project names are trademarks of the <a href=https://www.apache.org/>Apache Software Foundation</a>.</p></div></div></div></footer><script src=/js/bootstrap.min.0a0106334435d4110713bfaff4acaf02533b0c56d44412a74e9518db07672ddb7e099a9c7517bc9cb529e2ddd4ae2e438b40b720288900d5e74fb6d8928d9097.js integrity="sha512-CgEGM0Q11BEHE7+v9KyvAlM7DFbURBKnTpUY2wdnLdt+CZqcdRe8nLUp4t3Uri5Di0C3ICiJANXnT7bYko2Qlw==" crossorigin=anonymous defer></script>
<script src=/js/highlight.min.0d31f7af12feb83ee633b6351b023ee643ea3412376fbaa09c5a26d1a5ef999939f1ad379a5b12e1199a2c7d72ae1b23f633060a679628dcbfb0e72378cd20be.js integrity="sha512-DTH3rxL+uD7mM7Y1GwI+5kPqNBI3b7qgnFom0aXvmZk58a03mlsS4RmaLH1yrhsj9jMGCmeWKNy/sOcjeM0gvg==" crossorigin=anonymous defer></script>
<script src=/main.min.6afc4bf655f45ae3e63629ec95be8bd2e0e792084b5635a6fe70b169fa9d1491638b3a4e900ed59c2e017ca18768e5c392e110d0e1336509f49f7dc418d16eef.js integrity="sha512-avxL9lX0WuPmNinslb6L0uDnkghLVjWm/nCxafqdFJFjizpOkA7VnC4BfKGHaOXDkuEQ0OEzZQn0n33EGNFu7w==" crossorigin=anonymous defer></script>
<script src=/index.min.ce073a6bfcdde2aa09e6df3a4d44f39255cd08ce305d73e218e0577ad19e1c2f4c6bc14f8f95e3c55624c06521059a4467b61eca6458708dd25bf2411439694d.js integrity="sha512-zgc6a/zd4qoJ5t86TUTzklXNCM4wXXPiGOBXetGeHC9Ma8FPj5XjxVYkwGUhBZpEZ7YeymRYcI3SW/JBFDlpTQ==" crossorigin=anonymous defer></script></body></html>